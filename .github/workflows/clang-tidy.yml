name: clang-tidy

on: [push, pull_request]

jobs:
  tidy:
    runs-on: ubuntu-latest
    container:
      image: pointcloudlibrary/env:22.04
    
    steps:
    - uses: actions/checkout@v2

    - name: Run clang-tidy
      run: |
          wget https://apt.llvm.org/llvm.sh
          chmod +x llvm.sh
          ./llvm.sh 14
          apt-get update
          apt-get install -y clang-tidy-14 clang-tools-14 python3-pip
          pip install pyyaml
          cmake .
          run-clang-tidy-14.py -config='' -header-filter='.*' -fix
          git diff > tidy.patch
          cat tidy.patch
          [ ! -s tidy.patch ]

